<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simplified Index Management</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
            max-width: 600px;
        }
        .header {
            display: flex;
            align-items: center;
            max-width: 600px;
            margin-bottom: 20px;
            position: relative;
            min-height: 40px;
        }
        .back-button {
            background: none;
            border: none;
            font-size: 24px;
            color: black;
            cursor: pointer;
            padding: 8px;
            margin-right: 15px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            transition: background-color 0.3s;
            position: absolute;
            left: 0;
        }
        .back-button:hover {
            background-color: #f0f0f0;
        }
        .note-panel {
            background-color: #e8f4fd;
            border: 1px solid #b3d7f7;
            border-radius: 6px;
            padding: 12px 16px;
            margin: 15px auto 20px auto;
            max-width: 600px;
            font-size: 14px;
            color: #0066cc;
        }
        .note-panel a {
            color: #0066cc;
            text-decoration: none;
            font-weight: 500;
        }
        .note-panel a:hover {
            text-decoration: underline;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .panel {
            background-color: white;
            padding: 20px;
            max-width: 600px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .panel h2 {
            margin-top: 0;
            color: #333;
        }
        .header h1 {
            flex: 1;
            text-align: center;
            margin: 0;
        }
        @media (max-width: 700px) {
            .panel {
                padding: 16px;
            }
        }
    </style>
    
</head>
<body>
    <div class="header">
        <a href="index.html" class="back-button">&lt;</a>
        <h1>Simplified Index Management</h1>
    </div>

    <div class="container">
        <div class="panel">
            <h2>Overview</h2>
            <p>Note: this feature is currently in Beta mode.
            </p><p>
                Simplified Index Management for AEM as a Cloud Service
                is a simple way to define custom indexes and customize
                out-of-the-box (OOTB) indexes, using one JSON file.
                There is no need to copy definitions, or to explicitly define versions.
                When deploying the diff by running the pipeline, 
                the changes are automatically merged with the latest out-of-the-box index, 
                and if needed, a new version is automatically created.
            </p><p>
                Indexes created using simplified index management 
                have a property "mergeInfo" that links here.
                For more information about indexing, see: 
                <a href="https://experienceleague.adobe.com/en/docs/experience-manager-cloud-service/content/operations/indexing" target="_blank">Content Search and Indexing</a>.
            </p>
            <h2>Tools</h2>
            <p>
                <ul>
                    <li><a href="indexDefAnalyzer.html" style="color: #007cba; text-decoration: none;">Index Definition Analyzer</a>:    
                        create a diff index from existing indexes.</li>
                    <li><a href="diffIndexVerifier.html" style="color: #007cba; text-decoration: none;">Diff Index Verifier</a>:    
                        verifies the correctness of the diff index.</li>
                </ul>
            </p>
            <h2>Step by Step Migration Guide</h2>
            <p>
                This guide assumes you already have an AEM as a Cloud Service program
                with custom or customized indexes.
            </p>
            <h3>Create the Diff Index</h3>
            <p>
                To create the diff index, open the AEM as a Cloud Service "Developer Console".
                Select "Status Dump": "Oak Indexes", and "Output Format": "JSON". 
                Click "Get Status", and then click on the "Download" button at the top right.
                This will open the raw JSON file in a new tab.
                Select the whole content, and copy it to the clipboard.
                Then open the <a href="indexDefAnalyzer.html">Index Definition Analyzer</a>.
                and paste the content into the "Index Definitions (JSON)" textarea.
                Click "Analyze".
                On the right side, you will get the diff index.
                Verify it contains the changes you want to apply.
                If you manually changed the diff index, 
                you can verify it by opening the <a href="diffIndexVerifier.html">Diff Index Verifier</a>.
            </p>
            <h3>Store the Diff Index</h3>
            <p>
                In the Git repository of your program, 
                in the directory <code>ui.apps/src/main/content/jcr_root/_oak_index</code>,
                create a new directory named <code>diff.index</code>.
                Inside it, create a new file called <code>.content.xml</code>,
                with the following content. You will not need to change this file later.
                It is needed currently for compatibility with the existing tooling.
<pre>
&lt;?xml version="1.0" encoding="UTF-8"?>&lt;jcr:root
    xmlns:jcr="http://www.jcp.org/jcr/1.0"
    xmlns:nt="http://www.jcp.org/jcr/nt/1.0"
    jcr:primaryType="nt:unstructured"
    type="lucene" includedPaths="/same" queryPaths="/same">
&lt;diff.json jcr:primaryType="nt:file"/>&lt;/jcr:root>
</pre>
                Then create a new file called <code>diff.json</code> in the same directory.
                Copy the content of the diff index into this file.
                Also, in the file <code>/ui.apps/src/main/content/META-INF/vault/filter.xml</code>,
                add the following line:
<pre>
    &lt;filter root="/oak:index/diff.index" />
</pre>
            </p>
            <h3>Deploy the Diff Index</h3>
            <p>
                Run the pipeline to deploy the diff index.
                This will merge the diff index with the latest out-of-the-box index,
                and if needed, a new version is automatically created.
            </p>
            <h3>Example diff.json File</h3>
            <p>
                The following is an example of a diff.json file.
                It contains a customization for the damAssetLucene index,
                and a fully custom index named "custom.slingFolderNodeNames".
                For fully custom indexes, the name needs to contain a dot.
                The index name does not contains the "/oak:index/" prefix.
                Also, fully custom indexes need to have an "includedPaths" property that is not empty,
                and set to a path that doesn't include "/apps" or "/libs". It is best to set the "queryPaths"
                to the same value as the "includedPaths".
<pre>
{
    "damAssetLucene": {
        "indexRules": {
            "dam:Asset": {
                "properties": {
                    "test1": {
                        "name": "test",
                        "propertyIndex": true
                    }
                }
            }
        }
    },
    "custom.slingFolderNodeNames": {
        "async": [ "async" ],
        "compatVersion": 2,
        "evaluatePathRestrictions": true,
        "includedPaths": [ "/content/dam" ],
        "queryPaths": [ "/content/dam" ],
        "type": "lucene",
        "indexRules": {
            "sling:Folder": {
                "indexNodeName": true
            }
        }
    }
}
</pre>
        </div>
    </div>

</body>
</html>


